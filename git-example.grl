import "git.tg"

graph Foo {
  r1, r2 : Revision
  dr1, dr2 : Dependencies

  r1 -:deps-> dr1
  r2 -:deps-> dr2

  dr2 -:dependsOn-> r1
}

rule Amend {
  match {
    r1 : Revision
    tr1 : Dependencies
    r1 -:deps-> tr1
  }

  forbid {
    tr2 : Dependencies
    tr2 -:dependsOn-> r1
  }

  clone r1 as r2
  clone tr1 as tr2
  create r2 -:deps-> tr2
}

rule Bar {
  require r1 : Revision
  require tr1 : Dependencies
  require r1 -:Deps-> tr1

  forbid tr1-:dependsOn->r1
}